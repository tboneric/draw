<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€¼ç­æ’ç­ç”Ÿæˆå™¨</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --bg-color: #f5f7fa;
            --container-bg: #ffffff;
            --border-color: #e1e4e8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--container-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .date-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .date-col {
            flex: 1;
            min-width: 200px;
        }

        input[type="date"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .options {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-row {
            text-align: center;
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-generate {
            background-color: var(--primary-color);
            color: white;
        }
        .btn-generate:hover {
            background-color: #357abd;
        }

        .btn-copy {
            background-color: #2ecc71;
            color: white;
            display: none;
        }
        .btn-copy:hover {
            background-color: #27ae60;
        }

        .result-area {
            margin-top: 30px;
            border-top: 2px solid var(--bg-color);
            padding-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        tr:hover {
            background-color: #f1f1f1;
        }

        .weekend {
            color: #e74c3c;
            font-weight: bold;
        }

        .error-msg {
            color: #e74c3c;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“… å€¼ç­æ’ç­ç”Ÿæˆå™¨</h1>

    <!-- æ—¥æœŸé€‰æ‹©åŒºåŸŸ -->
    <div class="input-group date-row">
        <div class="date-col">
            <label for="startDate">å¼€å§‹æ—¥æœŸï¼š</label>
            <input type="date" id="startDate">
        </div>
        <div class="date-col">
            <label for="endDate">ç»“æŸæ—¥æœŸï¼š</label>
            <input type="date" id="endDate">
        </div>
    </div>

    <!-- äººå‘˜åå•åŒºåŸŸ -->
    <div class="input-group">
        <label for="nameList">äººå‘˜åå•ï¼ˆæ”¯æŒæ¢è¡Œã€é€—å·æˆ–åˆ†å·åˆ†éš”ï¼‰ï¼š</label>
        <textarea id="nameList" placeholder="ä¾‹å¦‚ï¼š
å¼ ä¸‰
æå››; ç‹äº”
èµµå…­ï¼Œé’±ä¸ƒ"></textarea>
    </div>

    <!-- é€‰é¡¹ -->
    <div class="options">
        <input type="checkbox" id="skipWeekend" checked>
        <label for="skipWeekend" style="margin-bottom: 0; cursor: pointer;">è·³è¿‡å‘¨å…­å’Œå‘¨æ—¥</label>
    </div>

    <!-- æŒ‰é’® -->
    <div class="btn-row">
        <button class="btn-generate" onclick="generateRoster()">ğŸ² ç”Ÿæˆæ’ç­è¡¨</button>
        <button class="btn-copy" id="copyBtn" onclick="copyToClipboard()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
    </div>
    
    <div class="error-msg" id="errorMsg"></div>

    <!-- ç»“æœå±•ç¤º -->
    <div class="result-area" id="resultArea" style="display: none;">
        <h3>æ’ç­ç»“æœï¼š</h3>
        <table id="resultTable">
            <thead>
                <tr>
                    <th>æ—¥æœŸ</th>
                    <th>æ˜ŸæœŸ</th>
                    <th>å€¼ç­äººå‘˜</th>
                </tr>
            </thead>
            <tbody>
                <!-- JSç”Ÿæˆå†…å®¹ -->
            </tbody>
        </table>
    </div>
</div>

<script>
    // ä¸“é—¨ç”¨äºè®¾ç½®input valueçš„æ ¼å¼åŒ–å‡½æ•° (YYYY-MM-DD)
    function formatDateForInput(date) {
        const y = date.getFullYear();
        const m = String(date.getMonth() + 1).padStart(2, '0');
        const d = String(date.getDate()).padStart(2, '0');
        return `${y}-${m}-${d}`;
    }

    // åˆå§‹åŒ–å’Œäº‹ä»¶ç›‘å¬
    window.onload = function() {
        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');

        // 1. è®¾ç½®é»˜è®¤å€¼ï¼šå¼€å§‹=ä»Šå¤©ï¼Œç»“æŸ=æ˜å¤©
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(today.getDate() + 1);

        startDateInput.value = formatDateForInput(today);
        endDateInput.value = formatDateForInput(tomorrow);

        // 2. ç›‘å¬å¼€å§‹æ—¥æœŸå˜åŒ–ï¼Œè‡ªåŠ¨è®¾ç½®ç»“æŸæ—¥æœŸä¸º Start + 1
        startDateInput.addEventListener('change', function() {
            if (this.value) {
                const selectedDate = new Date(this.value);
                const nextDay = new Date(selectedDate);
                nextDay.setDate(selectedDate.getDate() + 1);
                
                endDateInput.value = formatDateForInput(nextDay);
            }
        });
    }

    // æ´—ç‰Œç®—æ³•
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // è·å–æ˜ŸæœŸå‡ ä¸­æ–‡
    function getWeekDayCN(date) {
        const days = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
        return days[date.getDay()];
    }

    function generateRoster() {
        const startDateVal = document.getElementById('startDate').value;
        const endDateVal = document.getElementById('endDate').value;
        const rawNames = document.getElementById('nameList').value;
        const skipWeekend = document.getElementById('skipWeekend').checked;
        const errorMsg = document.getElementById('errorMsg');
        const resultArea = document.getElementById('resultArea');
        const tbody = document.querySelector('#resultTable tbody');
        const copyBtn = document.getElementById('copyBtn');

        errorMsg.style.display = 'none';
        
        if (!startDateVal || !endDateVal) {
            showError("è¯·é€‰æ‹©å®Œæ•´çš„æ—¥æœŸåŒºé—´ï¼");
            return;
        }

        const start = new Date(startDateVal);
        const end = new Date(endDateVal);

        if (start > end) {
            showError("å¼€å§‹æ—¥æœŸä¸èƒ½æ™šäºç»“æŸæ—¥æœŸï¼");
            return;
        }

        // å¤„ç†åå•ï¼šæ”¯æŒæ¢è¡Œã€ä¸­è‹±æ–‡é€—å·ã€ä¸­è‹±æ–‡åˆ†å·
        let names = rawNames.split(/[\n,ï¼Œ;ï¼›]/)
                            .map(n => n.trim())
                            .filter(n => n.length > 0);

        if (names.length === 0) {
            showError("è¯·è¾“å…¥äººå‘˜åå•ï¼");
            return;
        }

        let shuffledNames = shuffleArray([...names]); 
        let currentDate = new Date(start);
        let roster = [];
        let nameIndex = 0;

        tbody.innerHTML = ''; 

        // é˜²æ­¢æ­»å¾ªç¯ï¼ˆæ¯”å¦‚é€‰äº†å¾ˆä¹…çš„åŒºé—´ä½†å…¨æ˜¯å‘¨æœ«ä¸”é€‰æ‹©äº†è·³è¿‡å‘¨æœ«ï¼‰
        let maxIterations = 3650; // æœ€å¤šç”Ÿæˆ10å¹´
        let loopCount = 0;

        while (currentDate <= end) {
            if (loopCount++ > maxIterations) break;

            const dayOfWeek = currentDate.getDay(); 
            let isWeekend = (dayOfWeek === 0 || dayOfWeek === 6);

            if (skipWeekend && isWeekend) {
                // è·³è¿‡å‘¨æœ«ï¼Œä¸æ’ç­
            } else {
                let person = shuffledNames[nameIndex % shuffledNames.length];
                
                roster.push({
                    date: formatDateForInput(currentDate), // å¤ç”¨ä¸Šé¢çš„æ ¼å¼åŒ–å‡½æ•°
                    week: getWeekDayCN(currentDate),
                    person: person,
                    isWeekend: isWeekend
                });

                nameIndex++;
            }
            currentDate.setDate(currentDate.getDate() + 1);
        }

        if (roster.length === 0) {
            showError("é€‰å®šçš„åŒºé—´å†…æ²¡æœ‰éœ€è¦å€¼ç­çš„æ—¥å­ï¼ˆå¯èƒ½æ˜¯å…¨æ˜¯å‘¨æœ«ï¼‰ï¼");
            return;
        }

        roster.forEach(item => {
            const tr = document.createElement('tr');
            const weekClass = (item.isWeekend) ? 'weekend' : '';

            tr.innerHTML = `
                <td>${item.date}</td>
                <td class="${weekClass}">${item.week}</td>
                <td><strong>${item.person}</strong></td>
            `;
            tbody.appendChild(tr);
        });

        resultArea.style.display = 'block';
        copyBtn.style.display = 'block';
    }

    function showError(msg) {
        const errorEl = document.getElementById('errorMsg');
        errorEl.innerText = msg;
        errorEl.style.display = 'block';
        document.getElementById('resultArea').style.display = 'none';
        document.getElementById('copyBtn').style.display = 'none';
    }

    function copyToClipboard() {
        const table = document.getElementById('resultTable');
        const range = document.createRange();
        range.selectNode(table);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        
        try {
            document.execCommand('copy');
            alert('ç»“æœå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
        } catch (err) {
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ã€‚');
        }
        selection.removeAllRanges();
    }
</script>

</body>
</html>
